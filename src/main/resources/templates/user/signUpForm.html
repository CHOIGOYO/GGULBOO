<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <!-- jquery cdn -->
    <script
            src="https://code.jquery.com/jquery-3.6.3.min.js"
            integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
            crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>회원가입</title>
</head>
<body>
<!-- js,ajax,jquery -->
<script th:inline="javascript">
    //이메일 중복회원 여부 확인 
    const emailDuplicateCheck = () => {
        //const email = document.getElementById("태그의 아이디값").value
        const email = document.getElementById("userEmail").value;
        // <span id="checkResult">      </span>에 출력하기
        const checkResult = document.getElementById("checkResult");
        console.log("입력값 :" , email);
        $.ajax({ // jquery에서 제공하는 ajax 함수 순수 자바스크립트 코드보다 사용하기 편함
            // 요청방식 : post , 주소 url: /SignUpForm/emailDuplicateCheck , 보내는데이터 : userEmail
            type:"post",
            url:"/SignUpForm/emailDuplicateCheck",
            data: {
                "userEmail": email // "전송되는 파라미터 값 이름 ": 파라미터
            },
            success : function(res){
                console.log("요청성공 : ", res);
                if(res == "ok"){
                    console.log("사용가능한 이메일입니다.");
                    checkEmail.style.color = "green";
                    checkEmail.innerHTML="사용가능한 이메일입니다.";
                } else {
                    console.log("이미 사용중인 이메일입니다.");
                    checkEmail.style.color = "red";
                    checkEmail.innerHTML="이미 사용중인 이메일입니다.";
                }
            },
            error : function(err){
                console.log("에러발생: ",err);
            }
        })
    }

    //비밀번호 확인 
    function  chackPassword(){
        var userPw = document.getElementById("userPw");
        var confirmPassword = document.getElementById("confirmPassword");
        var confrimMsg = document.getElementById('confirmMsg');
        var correctColor = "green";	//맞았을 때 출력되는 색깔.
        var wrongColor ="#ff0000";	//틀렸을 때 출력되는 색깔
        if(userPw.value == confirmPassword.value){
            confirmMsg.style.color = correctColor;/* span 태그의 ID(confirmMsg) 사용  */
            confirmMsg.innerHTML ="비밀번호 일치";
        } else{
			confirmMsg.style.color = wrongColor;
			confirmMsg.innerHTML ="비밀번호 불일치";
		}
    }

</script>
<!-- 회원가입 폼 -->
<div class="container-md shadow p-3 mb-5 mt-5 w-50 bg-body rounded">
    <!-- action속성 : form에 작성한 데이터를 어디로 보낼지 -->
    <form action="/member/save" method="post">
        <h3 class="center text-center">회원가입</h3>
        <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" name="userEmail" id="userEmail" onblur="emailDuplicateCheck()" placeholder="이메일을 입력해주세요">
            <span id="checkEmail"></span>
        </div>
        <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" name="userPw" id="userPw" placeholder="비밀번호를 입력해주세요">
        </div>
        <div class="mb-3">
            <label class="form-label">Confirm Password</label>
            <input type="password" class="form-control" name="confirmPassword" id="confirmPassword" onblur="chackPassword()" placeholder="비밀번호 확인">
            <span id="confirmMsg"></span>
        </div>
        <div class="mb-3">
            <label class="form-label">User name</label>
            <!-- name속성: 서버로 전송할 때 변수 이름의 역할 -->
            <input type="text" class="form-control" name="userName" id="userName" placeholder="이름을 입력해주세요">
        </div>
        <label class="mb-3 form-label" for="birth">생년월일</label>
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="mb-3" id="birth" onchange="checkAge()">
                        <div class="birth dropdown">
                            <select class="form-select form-select-sm" id="year" name="year">
                                <option value="">출생년도</option>
                                <th:block th:each="a: ${#numbers.sequence(2001,1900)}">
                                    <option th:value="${a}" th:text="${a}"></option>
                                </th:block>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="birth mx-1 dropdown">
                        <select class="form-select form-select-sm" id="month" name="month">
                            <option value="">월</option>
                            <th:block th:each="month: ${#numbers.listFormatInteger(#numbers.sequence(1,12),2)}">
                                <option class="dropdown-item" th:value="${month}" th:text="${month}"></option>
                            </th:block>
                        </select>
                    </div>
                </div>
                <div class="col">
                    <div class="birth dropdown">
                        <select class="form-select form-select-sm" id="day" name="day">
                            <option value="">일</option>
                            <th:block th:each="day: ${#numbers.listFormatInteger(#numbers.sequence(1,31),2)}">
                                <option class="dropdown-item" th:value="${day}" th:text="${day}"></option>
                            </th:block>
                        </select>
                    </div>
                    <span id="birth_check_msg"></span>
                </div>
            </div>
        </div>
        <div class="center text-center">
            <button type="submit" class="btn btn-primary">가입하기</button>
        </div>
    </form>
</div>
<!-- /회원가입  -->
</body>
</html>